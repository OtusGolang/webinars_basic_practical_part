---
marp: true
theme: default
class: invert
paginate: true
---

## Цели занятия

* понимать основы конкурентности в Go;

* начать работу с горутинами и каналами

---



## Краткое содержание

* горутины и каналы;

* сравнение буферизированных и небуферизованных каналов;

* использование каналов для передачи данных и синхронизации;

* оператор select

---
## конкурентность и параллелизм

* Конкурентность - способ организации кода, архитектура
* Параллелизм - одновременное выполнение несколькими исполнителями


* Перевод статьи Роба Пайка: https://habr.com/ru/articles/761754/

---

## конкурентность в Go

* Go обладает выразительными средствами для написания конкурентного кода
* Go поддерживает параллельное исполнение кода
* весь код в Go выполняется в горутинах (в тч main)
* запуск новой горутины:

```go
go func(){

// ...

}() // <- скобки в конце

```

---

```go
go func(){ ... }() 

go myfunc(a,b,c)

go myStruct.MyFunc()

```

---

## See code A

---
## горутины дёшевы


"Стандартный" способ реализации параллелизма - потоки (threads) ОС.

Go использует подход "кооперативной многозадачности" чтобы повторно использовать "дорогие" потоки ос для запуска сотен тысяч горутин.

* Параллелизм - столько сколько ядер

* Конкурентность - миллионы

---

## See code B

---
## управление горутинами


Go представляет несколько способов управления горутинами:

* примитивы синхронизации

* каналы

**Сегодня рассматриваем каналы**.



См так же:

* https://go101.org/article/channel.html

---

## See code C

---

## буферизированные каналы


Мы рассмотрели каналы без буферов.

Можно создать буферизированный

```go
ch := make(chan int, 10)

ch <- 0

cap(ch) // 10

len(ch) // 1
```

---

## See code D

---
## select

используется если надо одновременно ждать сигнал от нескольких каналов


```go
select{

case a := <- results: // ...

case <- timeout: // ...

}

```

---
## select and send

еще select можно использовать для отправки в каналы

---

## see code E

---

## close

* закрывает ТОЛЬКО источник (тот кто шлёт)

* всё ожидания прерываются, `for ... range` - завершается

---

## directed channels

## see code F

---

## chan - ref or value?

## See code G


--- 

## опрос
